/*-----------Part 1. Standard OLAP operations-----------*/
/*
Roll up: Display the average number of Literacy rate (adult female, % of females ages 15 and above) in three continents.
*/
SELECT
	f."Continent",
	avg(f."SE.ADT.LITR.FE.ZS")
from staging_fact as f
GROUP BY (f."Continent") order by avg(f."SE.ADT.LITR.FE.ZS") desc

/*
Slice: Contrast the number of adults living with HIV in nine countries in 2020
*/
select f."Country Name", avg(f."SH.DYN.AIDS") 
from staging_fact as f where f."Year" = '2020'
group by f."Country Name" order by avg(f."SH.DYN.AIDS") desc

/*
Dice: Contrast the School enrollment, secondary (% gross) in China and Canada in 2020, 2010 and 2005
*/
select
f."Country Name",
f."Year",
avg(f."SE.SEC.ENRR")
from staging_fact as f
where (f."Country Name" = 'China' or f."Country Name" = 'Canada') and (f."Year" = '2020' or f."Year" = '2010' or f."Year" = 2005)
group by(f."Country Name", f."Year") order by f."Country Name"

/*
Combining OLAP operations
1. Contrast the  number of adults living with HIV and the School enrollment, secondary (% gross) in India and Mexico in 2020 and 2010
2. Contrast the unemployment rates(male) and the Suicide mortality rate(male) in nine countries in 2020 and 2010
*/
select
f."Country Name",
f."Year",
avg(f."SE.SEC.ENRR") as "average of the secondary school enrollment (% gross)",
avg(f."SH.DYN.AIDS") as "average of the number of adults living with HIV"
from staging_fact as f
where (f."Country Name" = 'Mexico' or f."Country Name" = 'India') and (f."Year" = '2020' or f."Year" = '2010')
group by(f."Country Name", f."Year") order by f."Country Name"


select
f."Country Name",
f."Year",
avg(f."SL.UEM.TOTL.MA.ZS") as "average of Unemployment, male (% of male labor force)",
avg(f."SH.STA.SUIC.MA.P5") as "average of the Suicide mortality rate, male (per 100,000 male population)"
from staging_fact as f
where (f."Year" = '2020' or f."Year" = '2010')
group by(f."Country Name", f."Year") order by f."Country Name"




/*-----------Part 2. Explorative operation-----------*/
/*
Iceberg query: Find the top three countries with the highest average population growth
*/
select f."Country Name", avg(f."SP.POP.GROW") 
from staging_fact as f group by f."Country Name" 
order by avg(f."SP.POP.GROW") desc limit 3

/*
Windowing query: Display the Suicide mortality rate, male (per 100,000 male population) in continents
*/
SELECT
f."Continent",
f."Country Name",
f."SH.STA.SUIC.MA.P5" as "the Suicide mortality rate, male",
avg(f."SH.STA.SUIC.MA.P5")
OVER (PARTITION BY f."Continent") 
FROM staging_fact as f

/*
Using the Window clause: Display the average of Life expectancy at birth in male and female in nine countries.
*/
SELECT 
f."Continent",
f."Country Name",
f."SP.DYN.LE00.FE.IN" as "Life expectancy at birth, female (years)",
avg(f."SP.DYN.LE00.FE.IN") OVER w, 
f."SP.DYN.LE00.MA.IN" as "Life expectancy at birth, male (years)",
avg(f."SP.DYN.LE00.MA.IN") OVER w
FROM staging_fact as f
WINDOW w AS (PARTITION BY f."Continent");